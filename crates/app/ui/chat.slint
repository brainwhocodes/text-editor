import { Button, ComboBox, LineEdit, ScrollView } from "std-widgets.slint";
import { PanelHeader } from "components.slint";

export component SidePanel inherits Rectangle {
    in-out property <string> chat_input;
    in-out property <string> chat_output;
    in-out property <string> api_key_input;
    in-out property <string> key_status;
    in-out property <string> model_id;
    in-out property <string> model_status;
    callback send_chat(string);
    callback save_api_key(string);
    callback remove_api_key();
    callback save_model(string);

    background: #1e1e1e;

    VerticalLayout {
        spacing: 0px;

        PanelHeader {
            title: "AI CHAT";
        }

        Rectangle {
            background: #1e1e1e;

            VerticalLayout {
                padding: 16px;
                spacing: 16px;

                VerticalLayout {
                    spacing: 12px;

                    Text {
                        text: "AI Settings";
                        color: #cccccc;
                        font-size: 13px;
                        font-weight: 600;
                    }

                    VerticalLayout {
                        spacing: 8px;

                        Text {
                            text: root.model_status;
                            color: #858585;
                            font-size: 11px;
                        }

                        ComboBox {
                            model: [
                                "openai/gpt-4o-mini",
                                "openai/gpt-4o",
                                "anthropic/claude-3.5-sonnet",
                                "google/gemini-2.0-flash-001",
                            ];
                            current-value <=> root.model_id;
                            selected(value) => { root.save_model(value); }
                        }
                    }

                    VerticalLayout {
                        spacing: 8px;

                        Text {
                            text: root.key_status;
                            color: #858585;
                            font-size: 11px;
                        }

                        LineEdit {
                            text <=> root.api_key_input;
                            placeholder-text: "OpenRouter API Key";
                            input-type: password;
                        }

                        HorizontalLayout {
                            spacing: 8px;

                            Button {
                                text: "Save";
                                clicked => { root.save_api_key(root.api_key_input); }
                            }

                            Button {
                                text: "Remove";
                                clicked => { root.remove_api_key(); }
                            }
                        }
                    }
                }

                Rectangle {
                    height: 1px;
                    background: #3e3e42;
                }

                ScrollView {
                    min-height: 0px;
                    vertical-stretch: 1;

                    VerticalLayout {
                        padding: 8px;

                        Text {
                            text: root.chat_output;
                            color: #cccccc;
                            font-size: 12px;
                            wrap: word-wrap;
                        }
                    }
                }

                VerticalLayout {
                    spacing: 8px;

                    LineEdit {
                        text <=> root.chat_input;
                        placeholder-text: "Ask AI assistant...";
                    }

                    Button {
                        text: "Send";
                        clicked => { root.send_chat(root.chat_input); }
                    }
                }
            }
        }
    }
}
