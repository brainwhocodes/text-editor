import { ScrollView } from "std-widgets.slint";
import { EditorTab, EditorLine, DiffHunk, StatusBar } from "components.slint";

export struct EditorLineData {
    line_num: int,
    content: string,
    is_current: bool,
}

export struct TabData {
    filename: string,
    path: string,
    dirty: bool,
}

export component EditorWidget inherits Rectangle {
    in property <[EditorLineData]> lines: [];
    in property <int> current_line: 1;
    in property <bool> has_content: false;

    background: #1e1e1e;

    if (!root.has_content) : Rectangle {
        VerticalLayout {
            alignment: center;
            Text {
                text: "Select a file to open";
                color: #808080;
                font-size: 14px;
                horizontal-alignment: center;
            }
        }
    }

    if (root.has_content) : ScrollView {
        min-height: 0px;
        vertical-stretch: 1;

        VerticalLayout {
            spacing: 0px;
            padding-top: 4px;

            for line in root.lines: EditorLine {
                line_num: line.line_num;
                content: line.content;
                is_current: line.line_num == root.current_line;
            }
        }
    }
}

export component EditorArea inherits Rectangle {
    in property <[TabData]> tabs: [];
    in property <[EditorLineData]> lines: [];
    in property <int> current_line: 1;
    in-out property <int> active_tab: -1;
    in property <string> cursor_position: "Ln 1, Col 1";
    in property <string> language: "Plain Text";
    in property <string> ai_model: "gpt-4o-mini";
    in property <string> status_message: "";
    callback tab_selected(string);
    callback tab_closed(string);
    
    background: #1e1e1e;

    VerticalLayout {
        spacing: 0px;

        Rectangle {
            height: 36px;
            background: #2d2d2d;

            HorizontalLayout {
                padding-left: 4px;
                padding-right: 8px;
                spacing: 0px;

                for tab[idx] in root.tabs: EditorTab {
                    filename: tab.filename;
                    active: idx == root.active_tab;
                    dirty: tab.dirty;
                    activated => { root.active_tab = idx; root.tab_selected(tab.path); }
                    closed => { root.tab_closed(tab.path); }
                }

                Rectangle {
                    horizontal-stretch: 1;
                }
            }
        }

        EditorWidget {
            lines: root.lines;
            current_line: root.current_line;
            has_content: root.lines.length > 0;
            vertical-stretch: 1;
        }

        StatusBar {
            cursor_position: root.cursor_position;
            language: root.language;
            ai_model: root.ai_model;
        }
    }
}
