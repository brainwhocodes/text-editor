import { ExplorerPanel, FileEntry } from "explorer.slint";
import { EditorArea, EditorLineData, TabData } from "editor.slint";
import { SidePanel } from "chat.slint";

export { FileEntry, EditorLineData, TabData }

export component AppWindow inherits Window {
    // Chat properties
    in-out property <string> chat_input;
    in-out property <string> chat_output;
    in-out property <string> api_key_input;
    in-out property <string> key_status;
    in-out property <string> model_id;
    in-out property <string> model_status;
    callback send_chat(string);
    callback save_api_key(string);
    callback remove_api_key();
    callback save_model(string);

    // Explorer properties
    in property <string> workspace_name: "workspace";
    in property <[FileEntry]> files: [];
    in-out property <string> selected_path: "";
    callback file_selected(string);
    callback folder_toggled(string);

    // Editor properties
    in property <[TabData]> tabs: [];
    in property <[EditorLineData]> editor_lines: [];
    in property <int> current_line: 1;
    in-out property <int> active_tab: -1;
    in property <string> cursor_position: "Ln 1, Col 1";
    in property <string> language: "Plain Text";
    in property <string> status_message: "";
    callback tab_selected(string);
    callback tab_closed(string);

    title: "AI Code Editor";
    width: 1280px;
    height: 800px;
    background: #1e1e1e;

    HorizontalLayout {
        spacing: 0px;

        ExplorerPanel {
            width: 260px;
            workspace_name: root.workspace_name;
            files: root.files;
            selected_path <=> root.selected_path;
            file_selected(path) => { root.file_selected(path); }
            folder_toggled(path) => { root.folder_toggled(path); }
        }

        Rectangle {
            width: 1px;
            background: #3e3e42;
        }

        EditorArea {
            horizontal-stretch: 1;
            tabs: root.tabs;
            lines: root.editor_lines;
            current_line: root.current_line;
            active_tab <=> root.active_tab;
            cursor_position: root.cursor_position;
            language: root.language;
            ai_model: root.model_id;
            tab_selected(path) => { root.tab_selected(path); }
            tab_closed(path) => { root.tab_closed(path); }
        }

        Rectangle {
            width: 1px;
            background: #3e3e42;
        }

        SidePanel {
            width: 380px;
            chat_input <=> root.chat_input;
            chat_output <=> root.chat_output;
            api_key_input <=> root.api_key_input;
            key_status <=> root.key_status;
            model_id <=> root.model_id;
            model_status <=> root.model_status;
            send_chat(msg) => { root.send_chat(msg); }
            save_api_key(key) => { root.save_api_key(key); }
            remove_api_key() => { root.remove_api_key(); }
            save_model(model) => { root.save_model(model); }
        }
    }
}
