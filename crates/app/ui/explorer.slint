import { ScrollView } from "std-widgets.slint";
import { PanelHeader, FileTreeItem } from "components.slint";

export struct FileEntry {
    name: string,
    path: string,
    icon: string,
    indent: int,
    is_folder: bool,
    expanded: bool,
    visible: bool,
}

export component ExplorerPanel inherits Rectangle {
    in property <string> workspace_name: "text-editor";
    in property <[FileEntry]> files: [];
    in-out property <string> selected_path: "";
    callback file_selected(string);
    callback folder_toggled(string);

    background: #252526;

    VerticalLayout {
        spacing: 0px;

        PanelHeader {
            title: root.workspace_name;
            collapsible: true;
        }

        ScrollView {
            min-height: 0px;
            vertical-stretch: 1;

            VerticalLayout {
                spacing: 0px;
                padding-top: 4px;

                for entry in root.files: FileTreeItem {
                    name: entry.name;
                    icon: entry.icon;
                    indent: entry.indent;
                    is_folder: entry.is_folder;
                    expanded: entry.expanded;
                    selected: entry.path == root.selected_path;
                    is_visible: entry.visible;
                    clicked => {
                        if (entry.is_folder) {
                            root.folder_toggled(entry.path);
                        } else {
                            root.selected_path = entry.path;
                            root.file_selected(entry.path);
                        }
                    }
                }
            }
        }
    }
}
